function PortaHack(){let t={},e=1e3/60,n=4,l=null,o=0,r=0,i=0,A=!1,R=[],_=[],$=null,s=[],I=null,T=null,O=g,C=g.getWidth(),S=g.getHeight(),f={x1:60,x2:C-60,y1:10,y2:S-10},d={height:12,padding:2,textHeight:8},a={x1:f.x1,x2:f.x2,y1:f.y1,y2:f.y1+d.height},L={height:12,padding:2,textHeight:8},N={x1:f.x1,x2:f.x2,y1:a.y2,y2:a.y2+L.height},h={height:28,padding:2,textHeight:8},u={x1:f.x1,x2:f.x2,y1:N.y2,y2:N.y2+h.height},D={x1:f.x1,x2:f.x1+(f.x2-f.x1)*.35,y1:u.y2,y2:f.y2},x={x1:D.x2,x2:D.x2+(f.x2-f.x1)*.35,y1:u.y2,y2:f.y2},c={x1:x.x2,x2:f.x2,y1:u.y2,y2:f.y2},p=[],F="#000000",P="#00ff00",y="#007f00",B="videoStopped",U=["HACK","BIKE","HIKE","VOID","VEIN","RAINING","NULL","PULLING","DATA","BAIT","HOARD","ROOTING","HEX","DEBUG","SCRIPT","LOGIC","STACK","ARRAY","OBJECT","STRINGING","BRINGING","MODULE","IMPORT","EXPORT","EVENT","REACT","PACK","BACK","HANK","HARK","HALL","LIKE","PIKE","BAKE","BITE","BIND","VINE","VILE","VOYAGE","MOID","SOIL","GAINING","PAINTED","RAVINGS","MAILING","WAILING","RAILING","ARROW","SUBJECT","EJECTS","ABJECT","REJECT","OBSESS","JANE","MARK","MARY","FREEDOM","FRENCH","FLEETING","FLOP","VAULT","ACCESS","ARMORY","TARGET","BUFFER","CIRCUIT","ENCRYPT","OVERRIDE","PROTOCOL","SUBSYS","CRYPTO","UPLOAD","BOOTSEQ","FAILSAFE","NETWORK","SECURE","DISARM","ARCHIVE","CLEARANCE","DISPOSAL","EXPUNGED","FACILITY","FORMS","PERMIT","POLICY","QUOTA","RESTRICT","TERMINAL","VAULT-TEC","APPROVED","REJECTED","SUBMIT","RECORDS","OBEY","CONFORM","GLORIOUS","SURVIVAL","PROTECT","LOYALTY","CITIZEN","ISOLATED","HOPELESS","EXILED","ORDERED","MOURNING","EXPIRED","DECEASED","ALERTED","MISTER","ROBCO","RADIO","DINER","NUKA","PIPBOY","ATOMIC","BLISSFUL","OPTIMISM","PRESET","GENERATOR","TRIAGE","HYGIENE","ELEVATOR","HYDROGEN","OVERSEER","BYTE","INDEX","LOGIN","CACHE","ERROR","BUNKER","REACTOR","SHELTER","CONTROL","FISSION","CANTEEN","HIKING","HAIR","BARK","PINE","VINES","BAKER","HACKER","DULL","DATASET","INPUT","OUTPUT","FLAG","FILE","FIELD","SCRIPTED","STATIC","STACKED","OBJECTIFY","STAGING","MUDDLED","MODULES","EXPORTS","REACTED","REACTOR","BACKED","PACKED","PIKED","LIKED","BAKED","BINDER","VILELY","SOILED","MAILED","PAINTER","GAINED","REGAIN","CLEANUP","ARROWS","PROJECT","SUBTEXT","EJECTED","OBSESSED","SUBMITTER","CLEARLY","FREED","FRENZY","FLEEING","VAULTS","TARGETED","BUFFERED","NETWORKED","DISARMED","DISPOSABLE","EXILED","CITATION","ISOLATE","ORDERLY","ALERTS","NUCLEAR","ROBOTIC","PIPWIRE","PASSWORD","CACHE","CANTEENS","CONFORMED","SKOOMA","BETHESDA","VEGAS","OBLIVION","CASINO","FALLOUT","WASTELAND","PIP","DOOM","DOOMGUY","DOVAHKIIN","KHAJIIT","TAMRIEL","NERAVAR","SIERRA","STEALTHBOY","BOBBLEHEAD","ENCLAVE","BROTHERHOOD","VAULTTEC","RADAWAY","STIMPAK","GHOULED","SANCTUARY","LIBERTY","MEGATON","SHELTERED","ATOMCAT","PRESTON","NCR","CAESAR","NEWRENO","MIRELURK","SUPERDUPER","FISSION","GHOULSRULE"];!function t(e){for(var n=e.length-1;n>0;n--){var l=Math.random()*(n+1)|0,o=e[n];e[n]=e[l],e[l]=o}}(U);let w=U.slice(0,25),G=U.slice(25,50),M="knob1",H="knob2",m="torch",K=0,v=0,V=!1;function b(){O.setColor(F).fillRect(0,0,C,S)}function Y(){if(n<0||n>4)throw Error("Invalid number of attempts remaining: "+n);O.setColor(F).fillRect(u);let t=h.padding,e=h.textHeight,l=u.y1+e+t,o=n+" ATTEMPT(S) LEFT:";O.setColor(P).setFont("6x8").setFontAlign(-1,-1).drawString(o,u.x1+t,l);let r=u.x1+t+O.stringWidth(o)+5;for(let i=0;i<n;i++){let A=r+13*i;O.setColor(P).fillRect(A,l,A+8,l+8)}}function W(t){}function J(){let t=r<25,e=t?D:x,n=t?0:25,l=t?R[r]:_[r-n],i=l.line,A=e.y1+(r-n)*10;if(void 0!==J.prevRow&&void 0!==J.prevCol){let $=J.prevRow<25,I=$?D:x,T=$?0:25,C=$?R[J.prevRow]:_[J.prevRow-T],S=I.y1+(J.prevRow-T)*10,f="0xF"+(2404+J.prevRow).toString(16).padStart(3,"0");O.setColor(F).fillRect(I.x1,S,I.x2,S+10).setColor(P).setFont("6x8").setFontAlign(-1,-1).drawString(f+" "+C.line,I.x1+2,S)}J.prevRow=r,J.prevCol=o;let d="0xF"+(2404+r).toString(16).padStart(3,"0");O.setColor(P).setFont("6x8").setFontAlign(-1,-1).drawString(d+" "+i,e.x1+2,A);let a=s.find(t=>t.row===r&&o>=t.startCol&&o<=t.endCol);if(a){let L=e.x1+2+(7+a.startCol)*6,N=(a.endCol-a.startCol+1)*6;O.setColor(P).fillRect(L,A,L+N,A+10).setColor(F).drawString(i.substring(a.startCol,a.endCol+1),L,A);return}let h=t?w[r]:G[r-n],u=l.embedAt,c=h.length,p=i.substr(u,c),y=/^\.+$/.test(p);if(u>=0&&o>=u&&o<u+c&&!y){let B=e.x1+2+(7+u)*6;O.setColor(P).fillRect(B,A,B+6*c,A+10).setColor(F).drawString(p,B,A)}else{let U=e.x1+2+(7+o)*6;O.setColor(P).fillRect(U,A,U+6,A+10).setColor(F).drawString(i[o],U,A)}}function X(){A=!0,i=Date.now()+1e3,b(),te();let t="LOCKOUT INITIATED";O.setColor(P).setFontMonofonto18().setFontAlign(-1,-1).drawString(t,(C-O.stringWidth(t))/2,S/3);let n="Press radio button to retry or power to exit";O.setColor(y).setFontMonofonto16().setFontAlign(-1,-1).drawString(n,(C-O.stringWidth(n))/2,S/3+30),T&&(clearInterval(T),T=null);let l=!1;T=setInterval(()=>{Date.now()>=i&&BTN_PLAY.read()?l||(l=!0,clearInterval(T),T=null,tn()):l=!1},e)}function k(){let t=Math.floor((c.y2-c.y1)/10),e=p.slice(-t);O.setColor(F).fillRect(c),O.setFont("6x8").setFontAlign(-1,-1);for(let n=0;n<e.length;n++){let l=c.y2-10*(e.length-n),o=e[n];O.setColor(P).drawString(o,c.x1+2,l)}}function j(t,e,n,l){O.setFont("6x8").setFontAlign(-1,-1);for(let o=0;o<t.length;o++){let r="0xF"+(n+o).toString(16).padStart(3,"0"),i=l[o];if(!i||"string"!=typeof i.line){let A=`Invalid junk line at ${o}: ${JSON.stringify(i)}`;throw Error(A)}let R=i.line,_=e.y1+10*o;O.setColor(P).drawString(r+" "+R,e.x1+2,_)}}function Q(){O.setColor(F).fillRect(N);let t="";n<=0?(t="!!! ACCESS DENIED !!!    REBOOTING...",setTimeout(function(){X()},3500)):t=1===n?"!!! WARNING: LOCKOUT IMMINENT !!!":"ENTER PASSWORD NOW",O.setColor(P).setFont("6x8").setFontAlign(-1,-1).drawString(t,N.x1+L.padding,N.y1+L.padding)}function Z(t){let e=Date.now();if(!(e-K<100)){if(K=e,0===t)tl();else{r=(r+(t<0?1:-1)+50)%50;let n=r<25,l=n?0:25,i=n?R[r]:_[r-l],A=n?w[r]:G[r-l];o>=i.embedAt&&o<i.embedAt+A.length&&(o=i.embedAt),J()}}}function q(){let t=BTN_PLAY.read(),e=Date.now();t&&!V&&e-v>=100&&(v=e,A||tl()),V=t}function z(t){if(0===t){tl();return}let e=r<25,n=e?r:r-25,l=e?R[n]:_[n],i=e?w[n]:G[n],A=l.line.length,$=l.embedAt,s=1;o>=$&&o<$+i.length&&(s=t>0?Math.max(1,$+i.length-o):Math.max(1,o-$));let I=o+(t>0?s:-s);if(t>0&&e&&I>=A){r=n+25,o=0,J();return}if(t<0&&!e&&I<0){r=n,o=R[n].line.length-1,J();return}o=(I%A+A)%A,J()}function tt(){let t=[1,5,10,15,20],e=t.findIndex(t=>t===Pip.brightness),n=(e+1)%t.length;Pip.brightness=t[n],Pip.updateBrightness()}function te(){Pip.removeAllListeners(M),Pip.removeAllListeners(H),Pip.removeAllListeners(m)}function tn(){T&&(clearInterval(T),T=null),I&&(clearInterval(I),I=null),A=!1,o=0,r=0,n=4,$=null,p=[],R=[],_=[],l=null,J.prevRow=void 0,J.prevCol=void 0,t.run()}function tl(){let t=s.find(t=>t.row===r&&o>=t.startCol&&o<=t.endCol);if(t){!function t(e){let o;if(.5>Math.random()?(n=4,p.push("> TRIES RESET"),Y(),Q()):(o=function t(){let e=[];if(w.forEach((t,n)=>{if(t===l)return;let o=R[n];if(!o||"string"!=typeof o.line)return;let r=o.embedAt;r<0||r+t.length>o.line.length||/^\.+$/.test(o.line.substr(r,t.length))||e.push({side:"L",row:n,word:t})}),G.forEach((t,n)=>{if(t===l)return;let o=_[n];if(!o||"string"!=typeof o.line)return;let r=o.embedAt;r<0||r+t.length>o.line.length||/^\.+$/.test(o.line.substr(r,t.length))||e.push({side:"R",row:n,word:t})}),0===e.length)return null;let n=e[Math.random()*e.length|0],o="L"===n.side?R:_,r=o[n.row],i=r.embedAt,A=n.word.length,$=r.line;return r.line=$.slice(0,i)+".".repeat(A)+$.slice(i+A),n}(),p.push("> DUD REMOVED")),k(),o){let r="L"===o.side,i=r?D:x,A=o.row,$="0xF"+((r?2404:2608)+A).toString(16).padStart(3,"0"),I=i.y1+10*A;O.setColor(F).fillRect(i.x1,I,i.x2,I+10);let T=r?R[A].line:_[A].line;O.setColor(P).setFont("6x8").setFontAlign(-1,-1).drawString($+" "+T,i.x1+2,I)}J(),W(D),W(x),s=s.filter(t=>t!==e)}(t);return}let I=r<25,f=I?r:r-25,d=I?R[f]:_[f],a=(I?w:G)[f];if(!d||"string"!=typeof d.line||"number"!=typeof d.embedAt){console.error("select(): invalid junk at row",r,d);return}let L=d.embedAt,N=d.line,h=N.slice(L,L+a.length),u=/^\.+$/.test(h),B=!u&&o>=L&&o<L+a.length;if(1===p.length&&"> . "===p[0]&&p.pop(),n<=0){X();return}if(B){$=h;let U=p.findIndex(t=>t==="> "+$);if(-1!==U){let M=p[U+1];p.push("> "+$),M&&M.startsWith(">")&&p.push(M)}else{if($===l){p.push("> "+$),p.push("> ACCESS GRANTED"),k(),function t(){A=!0,i=Date.now()+1e3,b(),te();let n="ACCESS GRANTED";O.setColor(P).setFontMonofonto18().setFontAlign(-1,-1).drawString(n,(C-O.stringWidth(n))/2,S/3);let l="Press radio to restart or power to exit";O.setColor(y).setFontMonofonto16().setFontAlign(-1,-1).drawString(l,(C-O.stringWidth(l))/2,S/3+30),T&&(clearInterval(T),T=null);let o=!1;T=setInterval(()=>{Date.now()>=i&&BTN_PLAY.read()?o||(o=!0,clearInterval(T),T=null,tn()):o=!1},e)}();return}let H=0;if(h.length===l.length)for(let m=0;m<h.length;m++)h[m]===l[m]&&H++;let K=Math.floor((c.y2-c.y1)/10)-1;for(;p.length>K;)p.shift();p.push("> "+$),p.push(`> [${H}]`),n--,Y(),Q(),0===n&&p.push("> Entry denied")}}else{$=N[o];let v=Math.floor((c.y2-c.y1)/10);p.length>=v&&p.shift(),p.push("> ["+$+"]")}k()}function to(t,e){let n="{}[]<>?/\\|!@#$%^&*()-_=+;:\"',.`~";if(!e){let l="";for(let o=0;o<t;o++)l+=n[Math.random()*n.length|0];return{line:l,embedAt:t}}let r="",i=Math.random()*(t-e.length)|0;for(let A=0;A<t;A++)A===i?(r+=e,A+=e.length-1):r+=n[Math.random()*n.length|0];return{line:r,embedAt:i}}function tr(){Pip.removeAllListeners(B),O.setColor(F).fillRect(a),O.setColor(P).setFont("6x8").setFontAlign(-1,-1).drawString("ROBCO INDUSTRIES (TM) PORTA HACK V1.0.1 PROTOCOL",a.x1+d.padding,a.y1+d.padding),Q(),Y(),function t(){w.sort(()=>Math.random()-.5),G.sort(()=>Math.random()-.5),R=w.map(t=>.4>Math.random()?to(12,""):to(12,t)),_=G.map(t=>.4>Math.random()?to(12,""):to(12,t));let e=w.concat(G);l=e[Math.random()*e.length|0]}(),function t(){s=[];let e={"(":")","{":"}","[":"]","<":">"};function n(t,n){t.forEach((t,l)=>{let o=t.line;for(let r=0;r<o.length;r++){let i=o[r],A=e[i];if(A){for(let R=r+1;R<Math.min(r+7,o.length);R++)if(o[R]===A){s.push({row:l+n,startCol:r,endCol:R});break}}}})}n(R,0),n(_,25)}(),j(w,D,2404,R),j(G,x,2608,_),W(f),W(a),W(N),W(u),W(D),W(x),W(c),p.push("> . "),k(),Pip.on(M,Z),Pip.on(H,z),Pip.on(m,tt),T&&clearInterval(T),I&&clearInterval(I),I=setInterval(q,e)}return t.run=function(){if(!O||!bC)throw Error("Pip-Boy graphics not available!");bC.clear(),b(),te(),setWatch(()=>void(te(),I&&clearInterval(I),bC.clear(1).flip(),E.reboot()),BTN_POWER,{debounce:50,edge:"rising",repeat:!0}),Pip.videoStart("BOOT/BOOT.avi",{x:40}),Pip.on(B,tr)},t}PortaHack().run();
